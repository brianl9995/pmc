<pre>
 PMC: 0002
 Layer: Consensus (hard fork)
 Title: ScryptCHA
 Author: César <cesar@chaucha.cl>
 Status: Draft
 Type: Standard
 Created: 2020-01-27
 License: BSD 2-clause license.
</pre>

==Introducción==

Este documento describe una propuesta de cambio de la constante N de la función Scrypt en la Chauchera, a modo de crear un nuevo algoritmo de minería que hemos llamado ScryptCHA. Este cambio que permitirá descentralizar el proceso de generación de bloques de la Red Chaucha, mediante la individualización y diferenciación del algoritmo de minería de la Red Chaucha con respecto a los demás proyectos de criptomonedas activos en la actualidad.

==Motivación==

{| 
!nHeight
!nVersion (dec)
!nVersion (hex)
!Hash
|-
|0
|1
|00000001
|[https://explorer.cha.terahash.cl/block/6e27bffd2a104bea1c870be76aab1cce13bebb0db40606773827517da9528174 6e27bffd2a104bea1c870be76aab1cce13bebb0db40606773827517da9528174] 
|-
|1
|2
|00000002
|[https://explorer.cha.terahash.cl/block/eadcbcb3f8960778b1c39415d1447a5cb45981ac15b269e31924f5f4701ea0e8 eadcbcb3f8960778b1c39415d1447a5cb45981ac15b269e31924f5f4701ea0e8]
|-
|144878 
|536870912 
|20000000 
|[https://explorer.cha.terahash.cl/block/f53292f5fdf64fae715b92e06c0804c64541c6121f6942bc9c2afcb2d3010d4e f53292f5fdf64fae715b92e06c0804c64541c6121f6942bc9c2afcb2d3010d4e] 
|-
|144884
|2
|00000002 
|[https://explorer.cha.terahash.cl/block/f383077bbc26e0e88bef93c58b30357bbe9c87dd65a74f3ca8546a12d07ba40c f383077bbc26e0e88bef93c58b30357bbe9c87dd65a74f3ca8546a12d07ba40c]
|-
|145141 
|536870912 
|20000000 
|[https://explorer.cha.terahash.cl/block/c9d7f827718acccd2accda07c983fd9cccace261aa530873aa3cbfa4cd39274f c9d7f827718acccd2accda07c983fd9cccace261aa530873aa3cbfa4cd39274f]
|-
|145143 
|2 
|00000002 
|[https://explorer.cha.terahash.cl/block/8b2551959cd16fa6431df2cb9dfb9b8754c8ebd29853b5f7b804e2bfa1b1fc5c 8b2551959cd16fa6431df2cb9dfb9b8754c8ebd29853b5f7b804e2bfa1b1fc5c]
|-
|145167 
|536870915 
|20000003 
|[https://explorer.cha.terahash.cl/block/8ca157ba0aea00f816d75149d0e8616a5e9dfa2fdd0c380e601038a9f0692774 8ca157ba0aea00f816d75149d0e8616a5e9dfa2fdd0c380e601038a9f0692774]
|-
|153216 
|536870912 
|20000000 
|[https://explorer.cha.terahash.cl/block/6fe0d6be185bb2249fddb09bc0bc9243f0d950fc16f8f23255ccac7c5676c02e 6fe0d6be185bb2249fddb09bc0bc9243f0d950fc16f8f23255ccac7c5676c02e]
|}

==ScryptCHA==

La función [https://www.tarsnap.com/scrypt/scrypt.pdf Scrypt] se representa de la siguiente manera:

''scrypt(P, S, N, r, p, dkLen) = MFcrypt<sub>HMAC_SHA256,SMix<sub>r</sub></sub>(P, S, N, p, dkLen) 	''

En donde N se define como '''CPU/memory cost parameter''', en base a la relación entre el costo de ejecución de la función Scrypt con respecto al requisito de memoria que exige el algoritmo.

La implementación de la función Scrypt en Litecoin se realizó con un '''N = 1024''' para no sobrecargar los nodos con la validación del ''PoW Hash'' de cada bloque minado, pero este valor de ''CPU/Memory Cost'' puede ser aumentado gracias a las capacidades de hardware existentes en la actualidad.

Este cambio se puede realizar con un simple ''refactoring'' de la función presente en [https://github.com/proyecto-chaucha/chauchera/blob/master/src/crypto/scrypt.cpp#L328 src/crypto/scrypt.cpp], modificando el tamaño del '''SCRYPT_SCRATCHPAD_SIZE''' y los rangos que utilizan esta constante.

<source lang="c++">
void scrypt_1024_1_1_256(const char *input, char *output)
{
    char scratchpad[1024*128 + 63];
    scrypt_1024_1_1_256_sp(input, output, scratchpad, 1024);
}

void ScryptCHA(const char *input, char *output, int N)
{
    char scratchpad[N*128 + 63];
    scrypt_1024_1_1_256_sp(input, output, scratchpad, N);
}
</source>

{| 
!N
!Tiempo (seg)
!Hashrate (H/s)
|-
|2
|0.0101
|98940.9323
|-
|4
|0.0104
|96122.4705
|-
|8
|0.0113
|88834.1417
|-
16
|0.0139
|71762.5199
|-
32
|0.0205
|48701.8880
|-
64
|0.0342
|29281.6532
|-
128
|0.0619
|16142.3689
|-
256
|0.1022
|9787.0617
|-
512
|0.1891
|5287.6132
|-
1024
|0.3624
|2759.1945
|-
2048
|0.7310
|1368.0164
|-
4096
|1.4509
|689.2458
|-
8192
|2.8984
|345.0124
|-
16384
|5.8161
|171.9351
|-
32768
|11.9317
|83.8105
|}
